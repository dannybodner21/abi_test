<script>
    
window.addEventListener('load', function() {
  
  // amount minted label
  document.getElementById('mintedText').innerHTML = "0/10 NFTs Minted";
  
  // message label
  document.getElementById('message').innerHTML = "";
  
  // Check if Web3 has been injected by the browser:
  if (typeof web3 !== 'undefined') {
    
    // You have a web3 browser
    console.log('web3 connected');
	 
    const ethereumButton = document.getElementById('connectToMetamask');
    const showAccount = document.getElementById('showAccount');
    const amount = amountMinted();
    
    console.log(amount);
	  
    document.getElementById('mintedText').innerHTML = amount + "/10 NFTs Minted";
    
    if (amount == '10') {
	    document.getElementById('mintButton').style.visibility = 'hidden';
    }
	  
    if(showAccount) {
  	   ethereumButton.addEventListener("click", getAccount);
    }
	   
  } else {
     // Warn the user that they need to get a web3 browser
     // Or install MetaMask, maybe with a nice graphic.
  }
})
	
  async function getAccount() {
    const accounts = await ethereum.request({ method: 'eth_requestAccounts' });
    const account = accounts[0];
    showAccount.innerHTML = account;
  }
  
  var contract;
  
  if (typeof window.ethereum !== 'undefined') {
    console.log('MetaMask is installed!');
  }
  
  $(document).ready(function()
  {
    web3 = new Web3(web3.currentProvider);
	

    address = "0x92742C45d2573660Eb5F9C4C5d8C5059B7d3EdA3";
    abi = [
	{
		"inputs": [
			{
				"internalType": "bytes32",
				"name": "requestId",
				"type": "bytes32"
			},
			{
				"internalType": "uint256",
				"name": "randomness",
				"type": "uint256"
			}
		],
		"name": "rawFulfillRandomness",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	}
];
    

    contract = new web3.eth.Contract(abi, address);

    })
    
    async function mintNFT() {
  		const accounts = await ethereum.request({ method: 'eth_requestAccounts' });
  		const account = accounts[0];
	    
      		await contract.methods.mint(account, 1).send({from: account, value: '30000000000000000', gasPrice: '20000000000'})
	        .then(function (txHash) {
     		//console.log('Transaction sent...');
			
		amountMinted();
		document.getElementById('message').innerHTML = "Successful transaction!";
			
      		//console.dir(txHash);
      		//waitForTxToBeMined(txHash);
            
    		});   
    }

    
    async function waitForTxToBeMined (txHash) {
        let txReceipt;
        while (!txReceipt) {
            try {
                txReceipt = await web3.eth.getTransactionReceipt(txHash)
            } catch (err) {
                return console.log(err)
            }
        }
    }
	
    async function amountMinted() {
      const amount = await contract.methods.totalSupply().call();
      const amountString = amount.toString();
      document.getElementById('mintedText').innerHTML = amountString + "/10 NFTs Minted";
      if (amount == 10) {
	      document.getElementById('mintButton').style.visibility = 'hidden';
      }
      return amountString;
    }
    
    $('#mintButton').click(function()
    {
        mintNFT();
    })

</script>
